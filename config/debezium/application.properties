# Debezium Server Configuration
# CDC from Postgres â†’ NATS JetStream

# ============================================
# Sink: NATS JetStream
# ============================================
debezium.sink.type=nats-jetstream
debezium.sink.nats-jetstream.url=nats://nats:4222
debezium.sink.nats-jetstream.create-stream=true

# ============================================
# Source: PostgreSQL
# ============================================
debezium.source.connector.class=io.debezium.connector.postgresql.PostgresConnector
debezium.source.offset.storage.file.filename=data/offsets.dat
debezium.source.offset.flush.interval.ms=0

# Postgres connection
debezium.source.database.hostname=postgres
debezium.source.database.port=5432
debezium.source.database.user=jetstream
debezium.source.database.password=jetstream
debezium.source.database.dbname=jetstream

# Logical decoding
debezium.source.plugin.name=pgoutput
debezium.source.topic.prefix=cdc
debezium.source.table.include.list=public.users,public.orders

# Replication slot (Debezium creates this automatically)
debezium.source.slot.name=debezium_slot

# ============================================
# Transforms: Simplify output
# ============================================
# Flatten the event structure for easier consumption
debezium.transforms=unwrap
debezium.transforms.unwrap.type=io.debezium.transforms.ExtractNewRecordState
debezium.transforms.unwrap.drop.tombstones=true
debezium.transforms.unwrap.delete.handling.mode=rewrite
debezium.transforms.unwrap.add.fields=op,table,source.ts_ms

# ============================================
# Format: JSON
# ============================================
debezium.format.key=json
debezium.format.value=json
